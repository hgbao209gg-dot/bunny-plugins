(function(S,k,f,n,x,D,g,m,Y,P,X,d,W,I){"use strict";function M(e,r,t,a,l,s,o){try{var u=e[s](o),h=u.value}catch(A){t(A);return}u.done?r(h):Promise.resolve(h).then(a,l)}function v(e){return function(){var r=this,t=arguments;return new Promise(function(a,l){var s=e.apply(r,t);function o(h){M(s,a,l,o,u,"next",h)}function u(h){M(s,a,l,o,u,"throw",h)}o(void 0)})}}var Q="https://deeplx.mingming.dev/translate",Z=function(){var e=v(function*(r,t="auto",a,l=!1){try{if(l)return{source_lang:t,text:r};var s=yield(yield fetch(Q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r,source_lang:t,target_lang:a})})).json();if(s.code!==200)throw Error(`Failed to translate text from DeepL: ${s.message}`);return{source_lang:t,text:s.data}}catch(o){throw Error(`Failed to fetch from DeepL: ${o}`)}});return function(r){return e.apply(this,arguments)}}(),O={translate:Z},ee=function(){var e=v(function*(r,t="auto",a,l=!1){try{if(l)return{source_lang:t,text:r};var s="https://translate.googleapis.com/translate_a/single?"+new URLSearchParams({client:"gtx",sl:t,tl:a,dt:"t",dj:"1",source:"input",q:r}),o=yield(yield fetch(s)).json();return{source_lang:t,text:o.sentences.map(u=>u.trans).join("")}}catch(u){throw Error(`Failed to fetch from Google Translate: ${u}`)}});return function(r){return e.apply(this,arguments)}}(),G={translate:ee};function te(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function F(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ae(e,r,t){return r&&F(e.prototype,r),t&&F(e,t),e}function _(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var U=function(){function e(r,t,a){te(this,e),_(this,"name","Gemini"),_(this,"apiKey",void 0),_(this,"model",void 0),_(this,"prompt",void 0),this.apiKey=r,this.model=t,this.prompt=a}return ae(e,[{key:"translate",value:function(r,t){var a=this;return v(function*(){var l="https://generativelanguage.googleapis.com/v1beta/models/"+encodeURIComponent(a.model)+":generateContent?key="+encodeURIComponent(a.apiKey),s={contents:[{parts:[{text:a.prompt.replace("{text}",r).replace("{lang}",t)}]}]},o=yield fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok)throw new Error("Gemini API error: "+o.status);var u=yield o.json();return u.candidates?.[0]?.content?.parts?.[0]?.text||""})()}}]),e}(),j=f.findByProps("openLazy","hideActionSheet"),K=f.findByProps("ActionSheetRow")?.ActionSheetRow??m.Forms.FormRow,ne=f.findByStoreName("MessageStore"),re=f.findByStoreName("ChannelStore"),ie=n.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:D.semanticColors.INTERACTIVE_NORMAL}}),N=[],le=()=>x.before("openLazy",j,([e,r,t])=>{var a=t?.message;r!=="MessageLongPressActionSheet"||!a||e.then(l=>{var s=x.after("default",l,(o,u)=>{n.React.useEffect(()=>()=>{s()},[]);var h=Y.findInReactTree(u,p=>p?.[0]?.type?.name==="ActionSheetRow");if(h){var A=Math.max(h.findIndex(p=>p.props.message===n.i18n.Messages.MARK_UNREAD),0),c=ne.getMessage(a.channel_id,a.id);if(!(!c?.content&&!a.content)){var b=c?.id??a.id,ve=c?.content??a.content,C=N.find(p=>Object.keys(p)[0]===b,"cache object"),L=C?"Revert":"Translate",J=L==="Translate"?g.getAssetIDByName("LanguageIcon"):g.getAssetIDByName("ic_highlight"),Ae=function(){var p=v(function*(){try{var w=i.target_lang,R=L==="Translate";if(!c?.content){d.showToast("Kh\xF4ng c\xF3 n\u1ED9i dung \u0111\u1EC3 d\u1ECBch!",g.getAssetIDByName("Small"));return}var y;switch(i.translator){case 0:console.log("Translating with DeepL: ",c.content),y=yield O.translate(c.content,void 0,w,!R);break;case 1:console.log("Translating with GTranslate: ",c.content),y=yield G.translate(c.content,void 0,w,!R);break;case 2:console.log("Translating with Gemini: ",c.content);var Re=i.gemini_api_key||"",Se=i.gemini_model||"gemini-pro",_e=i.gemini_prompt||"Translate '{text}' to {lang}.",Ne=new U(Re,Se,_e),Ee=yield Ne.translate(c.content,w);y={text:Ee};break}if(!y||typeof y.text!="string"||!y.text.trim()){d.showToast("D\u1ECBch th\u1EA5t b\u1EA1i ho\u1EB7c kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3!",g.getAssetIDByName("Small"));return}n.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...c,content:`${R?y.text:C[b]} ${R?`\`[${w?.toLowerCase()}]\``:""}`,guild_id:re.getChannel(c.channel_id).guild_id},log_edit:!1,otherPluginBypass:!0}),R?N.unshift({[b]:ve}):N=N.filter(B=>B!==C,"cached data override")}catch(B){d.showToast("Failed to translate message. Please check Debug Logs for more info.",g.getAssetIDByName("Small")),P.logger.error(B)}finally{return j.hideActionSheet()}});return function(){return p.apply(this,arguments)}}();h.splice(A,0,n.React.createElement(K,{label:`${L} Message`,icon:n.React.createElement(K.Icon,{source:J,IconComponent:()=>n.React.createElement(n.ReactNative.Image,{resizeMode:"cover",style:ie.iconComponent,source:J})}),onPress:Ae}))}}})})}),se=function(e){return e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER",e}({}),H=function(e){return e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER=6]="USER",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT",e}({}),oe=function(e){return e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE",e}({}),z={Arabic:"AR",Bulgarian:"BG",Czech:"CS",Danish:"DA",German:"DE",Greek:"EL",English:"EN",Spanish:"ES",Estonian:"ET",Finnish:"FI",French:"FR",Hungarian:"HU",Indonesian:"ID",Italian:"IT",Japanese:"JA",Korean:"KO",Lithuanian:"LT",Latvian:"LV",Norwegian:"NO",Dutch:"NL",Polish:"PL",Portuguese:"PT",Romanian:"RO",Russian:"RU",Slovak:"SK",Slovenian:"SL",Swedish:"SV",Turkish:"TR",Ukrainian:"UK","Chinese-Simplified":"ZH"},ce={Afrikaans:"af",Albanian:"sq",Amharic:"am",Arabic:"ar",Armenian:"hy",Assamese:"as",Aymara:"ay",Azerbaijani:"az",Bambara:"bm",Basque:"eu",Belarusian:"be",Bengali:"bn",Bhojpuri:"bho",Bosnian:"bs",Bulgarian:"bg",Catalan:"ca",Cebuano:"ceb",Chichewa:"ny","Chinese (Simplified)":"zh-CN","Chinese (Traditional)":"zh-TW",Corsican:"co",Croatian:"hr",Czech:"cs",Danish:"da",Dhivehi:"dv",Dogri:"doi",Dutch:"nl",English:"en",Esperanto:"eo",Estonian:"et",Ewe:"ee",Filipino:"tl",Finnish:"fi",French:"fr",Frisian:"fy",Galician:"gl",Georgian:"ka",German:"de",Greek:"el",Guarani:"gn",Gujarati:"gu","Haitian Creole":"ht",Hausa:"ha",Hawaiian:"haw",Hebrew:"iw",Hindi:"hi",Hmong:"hmn",Hungarian:"hu",Icelandic:"is",Igbo:"ig",Ilocano:"ilo",Indonesian:"id",Irish:"ga",Italian:"it",Japanese:"ja",Javanese:"jw",Kannada:"kn",Kazakh:"kk",Khmer:"km",Kinyarwanda:"rw",Konkani:"gom",Korean:"ko",Krio:"kri","Kurdish (Kurmanji)":"ku","Kurdish (Sorani)":"ckb",Kyrgyz:"ky",Lao:"lo",Latin:"la",Latvian:"lv",Lingala:"ln",Lithuanian:"lt",Luganda:"lg",Luxembourgish:"lb",Macedonian:"mk",Maithili:"mai",Malagasy:"mg",Malay:"ms",Malayalam:"ml",Maltese:"mt",Maori:"mi",Marathi:"mr","Meiteilon (Manipuri)":"mni-Mtei",Mizo:"lus",Mongolian:"mn","Myanmar (Burmese)":"my",Nepali:"ne",Norwegian:"no","Odia (Oriya)":"or",Oromo:"om",Pashto:"ps",Persian:"fa",Polish:"pl",Portuguese:"pt",Punjabi:"pa",Quechua:"qu",Romanian:"ro",Russian:"ru",Samoan:"sm",Sanskrit:"sa","Scots Gaelic":"gd",Sepedi:"nso",Serbian:"sr",Sesotho:"st",Shona:"sn",Sindhi:"sd",Sinhala:"si",Slovak:"sk",Slovenian:"sl",Somali:"so",Spanish:"es",Sundanese:"su",Swahili:"sw",Swedish:"sv",Tajik:"tg",Tamil:"ta",Tatar:"tt",Telugu:"te",Thai:"th",Tigrinya:"ti",Tsonga:"ts",Turkish:"tr",Turkmen:"tk",Twi:"ak",Ukrainian:"uk",Urdu:"ur",Uyghur:"ug",Uzbek:"uz",Vietnamese:"vi",Welsh:"cy",Xhosa:"xh",Yiddish:"yi",Yoruba:"yo",Zulu:"zu"},$=f.findByProps("sendBotMessage"),ue=Object.entries(z).map(([e,r])=>({name:e,displayName:e,value:r})),ge=()=>X.registerCommand({name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen.",displayDescription:"Send a message using Dislate in any language chosen.",applicationId:"-1",type:oe.CHAT,inputType:se.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:H.STRING,required:!0},{name:"language",displayName:"language",description:"The language that Dislate will translate the text into. This can be any language from the list.",displayDescription:"The language that Dislate will translate the text into. This can be any language from the list.",type:H.STRING,choices:[...ue],required:!0}],execute(e,r){return v(function*(){var[t,a]=e;try{var l;switch(i.translator){case 0:l=yield O.translate(t.value,void 0,a.value);break;case 1:l=yield G.translate(t.value,void 0,a.value);break;case 2:var s=i.gemini_api_key||"",o=i.gemini_model||"gemini-pro",u=i.gemini_prompt||"Translate '{text}' to {lang}.",h=new U(s,o,u),A=yield h.translate(t.value,a.value);l={source_lang:void 0,text:A};break;default:l={source_lang:void 0,text:"No translator selected."}}return!l||typeof l.text!="string"||!l.text.trim()?(d.showToast("D\u1ECBch th\u1EA5t b\u1EA1i ho\u1EB7c kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3!",g.getAssetIDByName("Small")),$.sendBotMessage(r.channel.id,"D\u1ECBch th\u1EA5t b\u1EA1i ho\u1EB7c kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3!")):yield new Promise(c=>W.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(m.Codeblock,null,l.text),confirmText:"Yep, send it!",onConfirm:()=>c({content:l.text}),cancelText:"Nope, don't send it"}))}catch(c){return P.logger.error(c),$.sendBotMessage(r.channel.id,"Failed to translate message. Please check Debug Logs for more info.")}})()}}),{FormRow:E}=m.Forms,{ScrollView:q}=n.ReactNative,he=()=>{I.useProxy(i);var[e,r]=n.React.useState("");return i.translator==0?n.React.createElement(q,{style:{flex:1}},n.React.createElement(m.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:t=>{r(t)}}),Object.entries(z).filter(([t,a])=>t.toLowerCase().includes(e.toLowerCase())).map(([t,a])=>n.React.createElement(E,{label:t,trailing:()=>n.React.createElement(E.Arrow,null),onPress:()=>{i.target_lang!=a&&(i.target_lang=a,d.showToast(`Saved ToLang to ${t}`,g.getAssetIDByName("check")))}}))):n.React.createElement(q,{style:{flex:1}},n.React.createElement(m.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:t=>{r(t)}}),Object.entries(ce).filter(([t,a])=>t.toLowerCase().includes(e.toLowerCase())).map(([t,a])=>n.React.createElement(E,{label:t,trailing:()=>n.React.createElement(E.Arrow,null),onPress:()=>{i.target_lang!=a&&(i.target_lang=a,d.showToast(`Saved ToLang to ${t}`,g.getAssetIDByName("check")))}})))},de=()=>{I.useProxy(i);var{FormRow:e,FormInput:r}=m.Forms,{ScrollView:t}=n.ReactNative;return n.React.createElement(t,{style:{flex:1}},n.React.createElement(e,{label:"DeepL",trailing:()=>n.React.createElement(e.Arrow,null),onPress:()=>{i.translator!==0&&(i.translator=0,d.showToast("Saved Translator to DeepL",g.getAssetIDByName("check")))},selected:i.translator===0}),n.React.createElement(e,{label:"Google Translate",trailing:()=>n.React.createElement(e.Arrow,null),onPress:()=>{i.translator!==1&&(i.translator=1,d.showToast("Saved Translator to Google Translate",g.getAssetIDByName("check")))},selected:i.translator===1}),n.React.createElement(e,{label:"Gemini (Google AI)",trailing:()=>n.React.createElement(e.Arrow,null),onPress:()=>{i.translator!==2&&(i.translator=2,d.showToast("Saved Translator to Gemini",g.getAssetIDByName("check")))},selected:i.translator===2}),i.translator===2&&n.React.createElement(n.React.Fragment,null,n.React.createElement(r,{title:"Gemini API Key",value:i.gemini_api_key||"",onChange:a=>i.gemini_api_key=a,placeholder:"Paste your Gemini API key here"}),n.React.createElement(r,{title:"Gemini Model",value:i.gemini_model||"gemini-pro",onChange:a=>i.gemini_model=a,placeholder:"gemini-pro"}),n.React.createElement(r,{title:"Prompt",value:i.gemini_prompt||"Translate '{text}' to {lang}.",onChange:a=>i.gemini_prompt=a,placeholder:"Translate '{text}' to {lang}.",multiline:!0})))},{ScrollView:me,Text:pe}=n.ReactNative,{FormRow:T}=m.Forms,ye=n.stylesheet.createThemedStyleSheet({subheaderText:{color:D.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:n.constants.Fonts.PRIMARY_BOLD,fontSize:14}}),Te=()=>{var e=n.NavigationNative.useNavigation();return I.useProxy(i),n.React.createElement(me,null,n.React.createElement(T,{label:"Translate to",subLabel:i.target_lang?.toLowerCase(),leading:n.React.createElement(T.Icon,{source:g.getAssetIDByName("ic_activity_24px")}),trailing:()=>n.React.createElement(T.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translate to",render:he})}),n.React.createElement(T,{label:"Translator",subLabel:i.translator?"Google Translate":"DeepL",leading:n.React.createElement(T.Icon,{source:g.getAssetIDByName("ic_locale_24px")}),trailing:()=>n.React.createElement(T.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translator",render:de})}),n.React.createElement(pe,{style:ye.subheaderText,onPress:()=>n.url.openURL("https://github.com/Rico040/bunny-plugins")},`Build: (${k.manifest.hash.substring(0,7)})`))},i=k.storage;i.target_lang??="en",i.translator??=1;var V=[],fe={onLoad:()=>V=[le(),ge()],onUnload:()=>{for(var e of V)e()},settings:Te};return S.default=fe,S.settings=i,Object.defineProperty(S,"__esModule",{value:!0}),S})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.storage);
