(function(A,k,T,n,B,D,h,d,q,x,J,Y,w,y){"use strict";function M(e,r,a,t,l,s,o){try{var c=e[s](o),u=c.value}catch(R){a(R);return}c.done?r(u):Promise.resolve(u).then(t,l)}function v(e){return function(){var r=this,a=arguments;return new Promise(function(t,l){var s=e.apply(r,a);function o(u){M(s,t,l,o,c,"next",u)}function c(u){M(s,t,l,o,c,"throw",u)}o(void 0)})}}var X="https://deeplx.mingming.dev/translate",W=function(){var e=v(function*(r,a="auto",t,l=!1){try{if(l)return{source_lang:a,text:r};var s=yield(yield fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r,source_lang:a,target_lang:t})})).json();if(s.code!==200)throw Error(`Failed to translate text from DeepL: ${s.message}`);return{source_lang:a,text:s.data}}catch(o){throw Error(`Failed to fetch from DeepL: ${o}`)}});return function(r){return e.apply(this,arguments)}}(),O={translate:W},Z=function(){var e=v(function*(r,a="auto",t,l=!1){try{if(l)return{source_lang:a,text:r};var s="https://translate.googleapis.com/translate_a/single?"+new URLSearchParams({client:"gtx",sl:a,tl:t,dt:"t",dj:"1",source:"input",q:r}),o=yield(yield fetch(s)).json();return{source_lang:a,text:o.sentences.map(c=>c.trans).join("")}}catch(c){throw Error(`Failed to fetch from Google Translate: ${c}`)}});return function(r){return e.apply(this,arguments)}}(),G={translate:Z};function Q(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function U(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function ee(e,r,a){return r&&U(e.prototype,r),a&&U(e,a),e}function _(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}var ae=function(){function e(r,a,t){Q(this,e),_(this,"name","Gemini"),_(this,"apiKey",void 0),_(this,"model",void 0),_(this,"prompt",void 0),this.apiKey=r,this.model=a,this.prompt=t}return ee(e,[{key:"translate",value:function(r,a){var t=this;return v(function*(){var l="https://generativelanguage.googleapis.com/v1beta/models/"+encodeURIComponent(t.model)+":generateContent?key="+encodeURIComponent(t.apiKey),s={contents:[{parts:[{text:t.prompt.replace("{text}",r).replace("{lang}",a)}]}]},o=yield fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok)throw new Error("Gemini API error: "+o.status);var c=yield o.json();return c.candidates?.[0]?.content?.parts?.[0]?.text||""})()}}]),e}(),F=T.findByProps("openLazy","hideActionSheet"),j=T.findByProps("ActionSheetRow")?.ActionSheetRow??d.Forms.FormRow,te=T.findByStoreName("MessageStore"),ne=T.findByStoreName("ChannelStore"),re=n.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:D.semanticColors.INTERACTIVE_NORMAL}}),N=[],ie=()=>B.before("openLazy",F,([e,r,a])=>{var t=a?.message;r!=="MessageLongPressActionSheet"||!t||e.then(l=>{var s=B.after("default",l,(o,c)=>{n.React.useEffect(()=>()=>{s()},[]);var u=q.findInReactTree(c,m=>m?.[0]?.type?.name==="ActionSheetRow");if(u){var R=Math.max(u.findIndex(m=>m.props.message===n.i18n.Messages.MARK_UNREAD),0),g=te.getMessage(t.channel_id,t.id);if(!(!g?.content&&!t.content)){var p=g?.id??t.id,ve=g?.content??t.content,b=N.find(m=>Object.keys(m)[0]===p,"cache object"),L=b?"Revert":"Translate",V=L==="Translate"?h.getAssetIDByName("LanguageIcon"):h.getAssetIDByName("ic_highlight"),Re=function(){var m=v(function*(){try{var C=i.target_lang,S=L==="Translate",E;switch(i.translator){case 0:console.log("Translating with DeepL: ",g.content),E=yield O.translate(g.content,void 0,C,!S);case 1:console.log("Translating with GTranslate: ",g.content),E=yield G.translate(g.content,void 0,C,!S)}n.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...g,content:`${S?E.text:b[p]} ${S?`\`[${C?.toLowerCase()}]\``:""}`,guild_id:ne.getChannel(g.channel_id).guild_id},log_edit:!1,otherPluginBypass:!0}),S?N.unshift({[p]:ve}):N=N.filter(P=>P!==b,"cached data override")}catch(P){y.showToast("Failed to translate message. Please check Debug Logs for more info.",h.getAssetIDByName("Small")),x.logger.error(P)}finally{return F.hideActionSheet()}});return function(){return m.apply(this,arguments)}}();u.splice(R,0,n.React.createElement(j,{label:`${L} Message`,icon:n.React.createElement(j.Icon,{source:V,IconComponent:()=>n.React.createElement(n.ReactNative.Image,{resizeMode:"cover",style:re.iconComponent,source:V})}),onPress:Re}))}}})})}),le=function(e){return e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER",e}({}),K=function(e){return e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER=6]="USER",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT",e}({}),se=function(e){return e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE",e}({}),H={Arabic:"AR",Bulgarian:"BG",Czech:"CS",Danish:"DA",German:"DE",Greek:"EL",English:"EN",Spanish:"ES",Estonian:"ET",Finnish:"FI",French:"FR",Hungarian:"HU",Indonesian:"ID",Italian:"IT",Japanese:"JA",Korean:"KO",Lithuanian:"LT",Latvian:"LV",Norwegian:"NO",Dutch:"NL",Polish:"PL",Portuguese:"PT",Romanian:"RO",Russian:"RU",Slovak:"SK",Slovenian:"SL",Swedish:"SV",Turkish:"TR",Ukrainian:"UK","Chinese-Simplified":"ZH"},oe={Afrikaans:"af",Albanian:"sq",Amharic:"am",Arabic:"ar",Armenian:"hy",Assamese:"as",Aymara:"ay",Azerbaijani:"az",Bambara:"bm",Basque:"eu",Belarusian:"be",Bengali:"bn",Bhojpuri:"bho",Bosnian:"bs",Bulgarian:"bg",Catalan:"ca",Cebuano:"ceb",Chichewa:"ny","Chinese (Simplified)":"zh-CN","Chinese (Traditional)":"zh-TW",Corsican:"co",Croatian:"hr",Czech:"cs",Danish:"da",Dhivehi:"dv",Dogri:"doi",Dutch:"nl",English:"en",Esperanto:"eo",Estonian:"et",Ewe:"ee",Filipino:"tl",Finnish:"fi",French:"fr",Frisian:"fy",Galician:"gl",Georgian:"ka",German:"de",Greek:"el",Guarani:"gn",Gujarati:"gu","Haitian Creole":"ht",Hausa:"ha",Hawaiian:"haw",Hebrew:"iw",Hindi:"hi",Hmong:"hmn",Hungarian:"hu",Icelandic:"is",Igbo:"ig",Ilocano:"ilo",Indonesian:"id",Irish:"ga",Italian:"it",Japanese:"ja",Javanese:"jw",Kannada:"kn",Kazakh:"kk",Khmer:"km",Kinyarwanda:"rw",Konkani:"gom",Korean:"ko",Krio:"kri","Kurdish (Kurmanji)":"ku","Kurdish (Sorani)":"ckb",Kyrgyz:"ky",Lao:"lo",Latin:"la",Latvian:"lv",Lingala:"ln",Lithuanian:"lt",Luganda:"lg",Luxembourgish:"lb",Macedonian:"mk",Maithili:"mai",Malagasy:"mg",Malay:"ms",Malayalam:"ml",Maltese:"mt",Maori:"mi",Marathi:"mr","Meiteilon (Manipuri)":"mni-Mtei",Mizo:"lus",Mongolian:"mn","Myanmar (Burmese)":"my",Nepali:"ne",Norwegian:"no","Odia (Oriya)":"or",Oromo:"om",Pashto:"ps",Persian:"fa",Polish:"pl",Portuguese:"pt",Punjabi:"pa",Quechua:"qu",Romanian:"ro",Russian:"ru",Samoan:"sm",Sanskrit:"sa","Scots Gaelic":"gd",Sepedi:"nso",Serbian:"sr",Sesotho:"st",Shona:"sn",Sindhi:"sd",Sinhala:"si",Slovak:"sk",Slovenian:"sl",Somali:"so",Spanish:"es",Sundanese:"su",Swahili:"sw",Swedish:"sv",Tajik:"tg",Tamil:"ta",Tatar:"tt",Telugu:"te",Thai:"th",Tigrinya:"ti",Tsonga:"ts",Turkish:"tr",Turkmen:"tk",Twi:"ak",Ukrainian:"uk",Urdu:"ur",Uyghur:"ug",Uzbek:"uz",Vietnamese:"vi",Welsh:"cy",Xhosa:"xh",Yiddish:"yi",Yoruba:"yo",Zulu:"zu"},ce=T.findByProps("sendBotMessage"),ue=Object.entries(H).map(([e,r])=>({name:e,displayName:e,value:r})),ge=()=>J.registerCommand({name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen.",displayDescription:"Send a message using Dislate in any language chosen.",applicationId:"-1",type:se.CHAT,inputType:le.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:K.STRING,required:!0},{name:"language",displayName:"language",description:"The language that Dislate will translate the text into. This can be any language from the list.",displayDescription:"The language that Dislate will translate the text into. This can be any language from the list.",type:K.STRING,choices:[...ue],required:!0}],execute(e,r){return v(function*(){var[a,t]=e;try{var l;switch(i.translator){case 0:l=yield O.translate(a.value,void 0,t.value);break;case 1:l=yield G.translate(a.value,void 0,t.value);break;case 2:var s=i.gemini_api_key||"",o=i.gemini_model||"gemini-pro",c=i.gemini_prompt||"Translate '{text}' to {lang}.",u=new ae(s,o,c),R=yield u.translate(a.value,t.value);l={source_lang:void 0,text:R};break;default:l={source_lang:void 0,text:"No translator selected."}}var g=l&&typeof l.text=="string"?l.text:"[Translate failed or no result]";return yield new Promise(p=>Y.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(d.Codeblock,null,g),confirmText:"Yep, send it!",onConfirm:()=>p({content:g}),cancelText:"Nope, don't send it"}))}catch(p){return x.logger.error(p),ce.sendBotMessage(r.channel.id,"Failed to translate message. Please check Debug Logs for more info.")}})()}}),{FormRow:I}=d.Forms,{ScrollView:z}=n.ReactNative,he=()=>{w.useProxy(i);var[e,r]=n.React.useState("");return i.translator==0?n.React.createElement(z,{style:{flex:1}},n.React.createElement(d.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:a=>{r(a)}}),Object.entries(H).filter(([a,t])=>a.toLowerCase().includes(e.toLowerCase())).map(([a,t])=>n.React.createElement(I,{label:a,trailing:()=>n.React.createElement(I.Arrow,null),onPress:()=>{i.target_lang!=t&&(i.target_lang=t,y.showToast(`Saved ToLang to ${a}`,h.getAssetIDByName("check")))}}))):n.React.createElement(z,{style:{flex:1}},n.React.createElement(d.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:a=>{r(a)}}),Object.entries(oe).filter(([a,t])=>a.toLowerCase().includes(e.toLowerCase())).map(([a,t])=>n.React.createElement(I,{label:a,trailing:()=>n.React.createElement(I.Arrow,null),onPress:()=>{i.target_lang!=t&&(i.target_lang=t,y.showToast(`Saved ToLang to ${a}`,h.getAssetIDByName("check")))}})))},de=()=>{w.useProxy(i);var{FormRow:e,FormInput:r}=d.Forms,{ScrollView:a}=n.ReactNative;return n.React.createElement(a,{style:{flex:1}},n.React.createElement(e,{label:"DeepL",trailing:()=>n.React.createElement(e.Arrow,null),onPress:()=>{i.translator!==0&&(i.translator=0,y.showToast("Saved Translator to DeepL",h.getAssetIDByName("check")))},selected:i.translator===0}),n.React.createElement(e,{label:"Google Translate",trailing:()=>n.React.createElement(e.Arrow,null),onPress:()=>{i.translator!==1&&(i.translator=1,y.showToast("Saved Translator to Google Translate",h.getAssetIDByName("check")))},selected:i.translator===1}),n.React.createElement(e,{label:"Gemini (Google AI)",trailing:()=>n.React.createElement(e.Arrow,null),onPress:()=>{i.translator!==2&&(i.translator=2,y.showToast("Saved Translator to Gemini",h.getAssetIDByName("check")))},selected:i.translator===2}),i.translator===2&&n.React.createElement(n.React.Fragment,null,n.React.createElement(r,{title:"Gemini API Key",value:i.gemini_api_key||"",onChange:t=>i.gemini_api_key=t,placeholder:"Paste your Gemini API key here"}),n.React.createElement(r,{title:"Gemini Model",value:i.gemini_model||"gemini-pro",onChange:t=>i.gemini_model=t,placeholder:"gemini-pro"}),n.React.createElement(r,{title:"Prompt",value:i.gemini_prompt||"Translate '{text}' to {lang}.",onChange:t=>i.gemini_prompt=t,placeholder:"Translate '{text}' to {lang}.",multiline:!0})))},{ScrollView:pe,Text:me}=n.ReactNative,{FormRow:f}=d.Forms,ye=n.stylesheet.createThemedStyleSheet({subheaderText:{color:D.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:n.constants.Fonts.PRIMARY_BOLD,fontSize:14}}),fe=()=>{var e=n.NavigationNative.useNavigation();return w.useProxy(i),n.React.createElement(pe,null,n.React.createElement(f,{label:"Translate to",subLabel:i.target_lang?.toLowerCase(),leading:n.React.createElement(f.Icon,{source:h.getAssetIDByName("ic_activity_24px")}),trailing:()=>n.React.createElement(f.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translate to",render:he})}),n.React.createElement(f,{label:"Translator",subLabel:i.translator?"Google Translate":"DeepL",leading:n.React.createElement(f.Icon,{source:h.getAssetIDByName("ic_locale_24px")}),trailing:()=>n.React.createElement(f.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translator",render:de})}),n.React.createElement(me,{style:ye.subheaderText,onPress:()=>n.url.openURL("https://github.com/Rico040/bunny-plugins")},`Build: (${k.manifest.hash.substring(0,7)})`))},i=k.storage;i.target_lang??="en",i.translator??=1;var $=[],Te={onLoad:()=>$=[ie(),ge()],onUnload:()=>{for(var e of $)e()},settings:fe};return A.default=Te,A.settings=i,Object.defineProperty(A,"__esModule",{value:!0}),A})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.ui.alerts,vendetta.storage,vendetta.ui.toasts);
