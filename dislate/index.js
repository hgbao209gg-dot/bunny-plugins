(function(f,E,p,a,M,P,g,d,V,k,q,J,L,m){"use strict";function x(e,i,t,n,l,s,c){try{var o=e[s](c),u=o.value}catch(I){t(I);return}o.done?i(u):Promise.resolve(u).then(n,l)}function S(e){return function(){var i=this,t=arguments;return new Promise(function(n,l){var s=e.apply(i,t);function c(u){x(s,n,l,c,o,"next",u)}function o(u){x(s,n,l,c,o,"throw",u)}c(void 0)})}}var Y="https://deeplx.mingming.dev/translate",X=function(){var e=S(function*(i,t="auto",n,l=!1){try{if(l)return{source_lang:t,text:i};var s=yield(yield fetch(Y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:i,source_lang:t,target_lang:n})})).json();if(s.code!==200)throw Error(`Failed to translate text from DeepL: ${s.message}`);return{source_lang:t,text:s.data}}catch(c){throw Error(`Failed to fetch from DeepL: ${c}`)}});return function(i){return e.apply(this,arguments)}}(),O={translate:X},W=function(){var e=S(function*(i,t="auto",n,l=!1){try{if(l)return{source_lang:t,text:i};var s="https://translate.googleapis.com/translate_a/single?"+new URLSearchParams({client:"gtx",sl:t,tl:n,dt:"t",dj:"1",source:"input",q:i}),c=yield(yield fetch(s)).json();return{source_lang:t,text:c.sentences.map(o=>o.trans).join("")}}catch(o){throw Error(`Failed to fetch from Google Translate: ${o}`)}});return function(i){return e.apply(this,arguments)}}(),U={translate:W},G=p.findByProps("openLazy","hideActionSheet"),F=p.findByProps("ActionSheetRow")?.ActionSheetRow??d.Forms.FormRow,Z=p.findByStoreName("MessageStore"),Q=p.findByStoreName("ChannelStore"),ee=a.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:P.semanticColors.INTERACTIVE_NORMAL}}),R=[],ae=()=>M.before("openLazy",G,([e,i,t])=>{var n=t?.message;i!=="MessageLongPressActionSheet"||!n||e.then(l=>{var s=M.after("default",l,(c,o)=>{a.React.useEffect(()=>()=>{s()},[]);var u=V.findInReactTree(o,y=>y?.[0]?.type?.name==="ActionSheetRow");if(u){var I=Math.max(u.findIndex(y=>y.props.message===a.i18n.Messages.MARK_UNREAD),0),h=Z.getMessage(n.channel_id,n.id);if(!(!h?.content&&!n.content)){var w=h?.id??n.id,pe=h?.content??n.content,b=R.find(y=>Object.keys(y)[0]===w,"cache object"),C=b?"Revert":"Translate",$=C==="Translate"?g.getAssetIDByName("LanguageIcon"):g.getAssetIDByName("ic_highlight"),me=function(){var y=S(function*(){try{var _=r.target_lang,v=C==="Translate",B;switch(r.translator){case 0:console.log("Translating with DeepL: ",h.content),B=yield O.translate(h.content,void 0,_,!v);case 1:console.log("Translating with GTranslate: ",h.content),B=yield U.translate(h.content,void 0,_,!v)}a.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...h,content:`${v?B.text:b[w]} ${v?`\`[${_?.toLowerCase()}]\``:""}`,guild_id:Q.getChannel(h.channel_id).guild_id},log_edit:!1,otherPluginBypass:!0}),v?R.unshift({[w]:pe}):R=R.filter(D=>D!==b,"cached data override")}catch(D){m.showToast("Failed to translate message. Please check Debug Logs for more info.",g.getAssetIDByName("Small")),k.logger.error(D)}finally{return G.hideActionSheet()}});return function(){return y.apply(this,arguments)}}();u.splice(I,0,a.React.createElement(F,{label:`${C} Message`,icon:a.React.createElement(F.Icon,{source:$,IconComponent:()=>a.React.createElement(a.ReactNative.Image,{resizeMode:"cover",style:ee.iconComponent,source:$})}),onPress:me}))}}})})}),te=function(e){return e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER",e}({}),j=function(e){return e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER=6]="USER",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT",e}({}),ne=function(e){return e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE",e}({}),H={Arabic:"AR",Bulgarian:"BG",Czech:"CS",Danish:"DA",German:"DE",Greek:"EL",English:"EN",Spanish:"ES",Estonian:"ET",Finnish:"FI",French:"FR",Hungarian:"HU",Indonesian:"ID",Italian:"IT",Japanese:"JA",Korean:"KO",Lithuanian:"LT",Latvian:"LV",Norwegian:"NO",Dutch:"NL",Polish:"PL",Portuguese:"PT",Romanian:"RO",Russian:"RU",Slovak:"SK",Slovenian:"SL",Swedish:"SV",Turkish:"TR",Ukrainian:"UK","Chinese-Simplified":"ZH"},re={Afrikaans:"af",Albanian:"sq",Amharic:"am",Arabic:"ar",Armenian:"hy",Assamese:"as",Aymara:"ay",Azerbaijani:"az",Bambara:"bm",Basque:"eu",Belarusian:"be",Bengali:"bn",Bhojpuri:"bho",Bosnian:"bs",Bulgarian:"bg",Catalan:"ca",Cebuano:"ceb",Chichewa:"ny","Chinese (Simplified)":"zh-CN","Chinese (Traditional)":"zh-TW",Corsican:"co",Croatian:"hr",Czech:"cs",Danish:"da",Dhivehi:"dv",Dogri:"doi",Dutch:"nl",English:"en",Esperanto:"eo",Estonian:"et",Ewe:"ee",Filipino:"tl",Finnish:"fi",French:"fr",Frisian:"fy",Galician:"gl",Georgian:"ka",German:"de",Greek:"el",Guarani:"gn",Gujarati:"gu","Haitian Creole":"ht",Hausa:"ha",Hawaiian:"haw",Hebrew:"iw",Hindi:"hi",Hmong:"hmn",Hungarian:"hu",Icelandic:"is",Igbo:"ig",Ilocano:"ilo",Indonesian:"id",Irish:"ga",Italian:"it",Japanese:"ja",Javanese:"jw",Kannada:"kn",Kazakh:"kk",Khmer:"km",Kinyarwanda:"rw",Konkani:"gom",Korean:"ko",Krio:"kri","Kurdish (Kurmanji)":"ku","Kurdish (Sorani)":"ckb",Kyrgyz:"ky",Lao:"lo",Latin:"la",Latvian:"lv",Lingala:"ln",Lithuanian:"lt",Luganda:"lg",Luxembourgish:"lb",Macedonian:"mk",Maithili:"mai",Malagasy:"mg",Malay:"ms",Malayalam:"ml",Maltese:"mt",Maori:"mi",Marathi:"mr","Meiteilon (Manipuri)":"mni-Mtei",Mizo:"lus",Mongolian:"mn","Myanmar (Burmese)":"my",Nepali:"ne",Norwegian:"no","Odia (Oriya)":"or",Oromo:"om",Pashto:"ps",Persian:"fa",Polish:"pl",Portuguese:"pt",Punjabi:"pa",Quechua:"qu",Romanian:"ro",Russian:"ru",Samoan:"sm",Sanskrit:"sa","Scots Gaelic":"gd",Sepedi:"nso",Serbian:"sr",Sesotho:"st",Shona:"sn",Sindhi:"sd",Sinhala:"si",Slovak:"sk",Slovenian:"sl",Somali:"so",Spanish:"es",Sundanese:"su",Swahili:"sw",Swedish:"sv",Tajik:"tg",Tamil:"ta",Tatar:"tt",Telugu:"te",Thai:"th",Tigrinya:"ti",Tsonga:"ts",Turkish:"tr",Turkmen:"tk",Twi:"ak",Ukrainian:"uk",Urdu:"ur",Uyghur:"ug",Uzbek:"uz",Vietnamese:"vi",Welsh:"cy",Xhosa:"xh",Yiddish:"yi",Yoruba:"yo",Zulu:"zu"},ie=p.findByProps("sendBotMessage"),se=Object.entries(H).map(([e,i])=>({name:e,displayName:e,value:i})),le=()=>q.registerCommand({name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen.",displayDescription:"Send a message using Dislate in any language chosen.",applicationId:"-1",type:ne.CHAT,inputType:te.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:j.STRING,required:!0},{name:"language",displayName:"language",description:"The language that Dislate will translate the text into. This can be any language from the list.",displayDescription:"The language that Dislate will translate the text into. This can be any language from the list.",type:j.STRING,choices:[...se],required:!0}],execute(e,i){return S(function*(){var[t,n]=e;try{var l;switch(r.translator){case 0:l=yield O.translate(t.value,void 0,n.value);case 1:l=yield U.translate(t.value,void 0,n.value)}return yield new Promise(s=>J.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(d.Codeblock,null,l.text),confirmText:"Yep, send it!",onConfirm:()=>s({content:l.text}),cancelText:"Nope, don't send it"}))}catch(s){return k.logger.error(s),ie.sendBotMessage(i.channel.id,"Failed to translate message. Please check Debug Logs for more info.")}})()}}),{FormRow:A}=d.Forms,{ScrollView:K}=a.ReactNative,oe=()=>{L.useProxy(r);var[e,i]=a.React.useState("");return r.translator==0?a.React.createElement(K,{style:{flex:1}},a.React.createElement(d.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:t=>{i(t)}}),Object.entries(H).filter(([t,n])=>t.toLowerCase().includes(e.toLowerCase())).map(([t,n])=>a.React.createElement(A,{label:t,trailing:()=>a.React.createElement(A.Arrow,null),onPress:()=>{r.target_lang!=n&&(r.target_lang=n,m.showToast(`Saved ToLang to ${t}`,g.getAssetIDByName("check")))}}))):a.React.createElement(K,{style:{flex:1}},a.React.createElement(d.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:t=>{i(t)}}),Object.entries(re).filter(([t,n])=>t.toLowerCase().includes(e.toLowerCase())).map(([t,n])=>a.React.createElement(A,{label:t,trailing:()=>a.React.createElement(A.Arrow,null),onPress:()=>{r.target_lang!=n&&(r.target_lang=n,m.showToast(`Saved ToLang to ${t}`,g.getAssetIDByName("check")))}})))},{FormRow:N}=d.Forms,{ScrollView:ce}=a.ReactNative,ue=()=>(L.useProxy(r),a.React.createElement(ce,{style:{flex:1}},a.React.createElement(N,{label:"DeepL",trailing:()=>a.React.createElement(N.Arrow,null),onPress:()=>{r.translator!=0&&(r.translator=0,m.showToast("Saved Translator to DeepL",g.getAssetIDByName("check")))}}),a.React.createElement(N,{label:"Google Translate",trailing:()=>a.React.createElement(N.Arrow,null),onPress:()=>{r.translator!=1&&(r.translator=1,m.showToast("Saved Translator to Google Translate",g.getAssetIDByName("check")))}}))),{ScrollView:ge,Text:he}=a.ReactNative,{FormRow:T}=d.Forms,de=a.stylesheet.createThemedStyleSheet({subheaderText:{color:P.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:a.constants.Fonts.PRIMARY_BOLD,fontSize:14}}),ye=()=>{var e=a.NavigationNative.useNavigation();return L.useProxy(r),a.React.createElement(ge,null,a.React.createElement(T,{label:"Translate to",subLabel:r.target_lang?.toLowerCase(),leading:a.React.createElement(T.Icon,{source:g.getAssetIDByName("ic_activity_24px")}),trailing:()=>a.React.createElement(T.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translate to",render:oe})}),a.React.createElement(T,{label:"Translator",subLabel:r.translator?"Google Translate":"DeepL",leading:a.React.createElement(T.Icon,{source:g.getAssetIDByName("ic_locale_24px")}),trailing:()=>a.React.createElement(T.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translator",render:ue})}),a.React.createElement(he,{style:de.subheaderText,onPress:()=>a.url.openURL("https://github.com/Rico040/bunny-plugins")},`Build: (${E.manifest.hash.substring(0,7)})`))},r=E.storage;r.target_lang??="en",r.translator??=1;var z=[],Te={onLoad:()=>z=[ae(),le()],onUnload:()=>{for(var e of z)e()},settings:ye};return f.default=Te,f.settings=r,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.ui.alerts,vendetta.storage,vendetta.ui.toasts);
